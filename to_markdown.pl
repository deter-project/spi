#!/usr/bin/perl


while(<>) {
    print "---\nlayout: default\n---\n" if $. == 1;
    s/\r//g;
    s/^=\s+(.*)\s+=/\# $1/;
    s/^==\s+(.*)\s+==/\#\# $1/;
    s/^===\s+(.*)\s+===/\#\#\# $1/;
    s/^====\s+(.*)\s+====/\#\#\#\# $1/;
    s/^=====\s+(.*)\s+=====/\#\#\#\#\# $1/;
    s/^======\s+(.*)\s+======/\#\#\#\#\#\# $1/;
    s/(.*)::/* $1/;
    s/^\s\s([^\s\*])/    * $1/;
    s/\'\'\'/*/g;
    s/\'/\\'/g;
    s/{{{([^}]*)}}}/\`$1\`/g;
    /^{{{/ && ($code = 1) && next;
    if (/^}}}/) {
	$code = 0;
	next;
    }
    s/\=\|/|/g;
    s/\|\=/|/g;
    s/\|\|\s+\|\|/| - |/g;
    s/\|\|/|/g;
    print "    " if $code;
    s/\[wiki:(\S+)\s+([^\]]*)\]/[$2]($1.html)/;
    print;
}
